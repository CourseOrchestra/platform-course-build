<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Работа с данными через классы доступа к данным (курсоры) :: Платформа КУРС</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Платформа КУРС</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Поиск">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="../../index.html"><img src="../../_/img/course-orchestra-logo.svg" width="60rem"></a>
        <!--div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="celesta" data-version="7">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="1010_what_is_celesta.html">Челеста</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1010_what_is_celesta.html">Что такое Celesta?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1012_demo.html">Демонстрационный пример</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1013_maven_plugin.html">Maven-плагин</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1015_vocabulary.html">Словарь основных понятий Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1020_celesta_start.html">Операции, выполняемые при инициализации Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1030_basic_settings.html">Параметры конфигурации Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1040_system_tables.html">Системные таблицы Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1050_celesta_sql.html">Язык Celesta-SQL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1060_celesta_doc.html">CelestaDoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1065_celesta_instantiation.html">Создание экземпляра Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1070_call_context.html">Контекст вызова</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="1080_data_accessors.html">Работа с данными через классы доступа к данным (курсоры)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1088_security_logging.html">Распределение прав доступа и протоколирование изменений</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1090_blob.html">BLOB-поля</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1100_option.html">Options-поля</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1102_dynamic.html">Динамический доступ к данным</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1105_triggers.html">Триггеры</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1107_xrec.html">Объект xRec</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1110_lost_updates_protection.html">Защита от потерянных обновлений</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1120_meta.html">Метаданные Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="1130_celesta_unit.html">CelestaUnit</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2005_best_practices.html">Лучшие практики написания кода Celesta</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2010_supported_rdbms.html">Особенности работы Celesta с поддерживаемыми типами СУБД</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="2020_dbschema.html">Проектирование базы данных Celesta в DBSchema</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Челеста</span>
    <span class="version">7</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../mellophone/2/general.html">Мелофон</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mellophone/2/general.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../doc/1/st2-ui-state-in-url.html">Платформа КУРС</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../doc/1/st2-ui-state-in-url.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="1010_what_is_celesta.html">Челеста</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="1010_what_is_celesta.html">7</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../doc/1/general.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="1010_what_is_celesta.html">Челеста</a></li>
    <li><a href="1080_data_accessors.html">Работа с данными через классы доступа к данным (курсоры)</a></li>
  </ul>
</nav>
<!--  -->
<!--  -->
<!--  <div class="edit-this-page"><a href="file:///usr/src/app/target/doc/components/celesta/target/antora/modules/ROOT/pages/1080_data_accessors.adoc">Редактировать страницу</a></div>-->
<!--  -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Содержание" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Работа с данными через классы доступа к данным (курсоры)</h1>
<div class="sect1">
<h2 id="_классы_доступа_и_их_стандартные_методы">
<a class="anchor" href="#_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D1%8B_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%B8_%D0%B8%D1%85_%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%BD%D1%8B%D0%B5_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B"></a>1. Классы доступа и их стандартные методы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для каждой из таблиц и представлений, объявленных в CelestaSQL, генерируются классы доступа к данным.</p>
</div>
<div class="paragraph">
<p>Каждый экземпляр класса доступа к данным (его мы также будем именовать «курсор») в каждый момент времени хранит информацию об одной записи (строке) в базе данных, каждому полю записи в курсоре соответствует поле объекта.
Курсор можно передвигать по записям с учётом фильтров и сортировок.
Если курсор создан для таблицы, его также можно использовать для вставки, модификации и удаления данных.
В курсоре, созданном для представления, доступны только методы навигации по записям.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="_images/diag-791799dd9fe91e00e0fbf27966291c0546b7054f.png" alt="cursors">
</div>
</div>
<div class="paragraph">
<p>На UML-диаграмме показана иерархия классов доступа к данным.
В основе иерархии стоит класс <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/BasicDataAccessor.html"><code>BasicDataAccessor</code></a>.
Каждый класс курсоров наследуется от класса <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/BasicCursor.html"><code>BasicCursor</code></a>, класс <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/Sequence.html"><code>Sequence</code></a> от <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/BasicDataAccessor.html"><code>BasicDataAccessor</code></a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/Cursor.html">Cursor</a></dt>
<dd>
<p>предназначен для работы с таблицами.
Наследует все методы <code>BasicCursor</code>, а также добавляет ряд собственных методов для возможности модификации данных.</p>
</dd>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/ViewCursor.html">ViewCursor</a></dt>
<dd>
<p>предназначен для работы с представлениями, никаких собственных методов к <code>BasicCursor</code> не добавляет.</p>
</dd>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/MaterializedViewCursor.html">MaterializedViewCursor</a></dt>
<dd>
<p>предназначен для работы с материализованными представлениями.
Наследует все методы <code>BasicCursor</code>, а также добавляет ряд собственных методов для возможности получения данных по первичному ключу.</p>
</dd>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/ParameterizedViewCursor.html">ParameterizedViewCursor</a></dt>
<dd>
<p>предназначен для работы с функциями(параметризованными представлениями).
Никаких собственных методов к <code>BasicCursor</code> не добавляет, однако имеет отличный от базового класса конструктор.</p>
</dd>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/ReadOnlyTableCursor.html">ReadOnlyTableCursor</a></dt>
<dd>
<p>предназначен для работы с таблицами, объявленными с опцией WITH READ ONLY, никаких собственных методов к <code>BasicCursor</code> не добавляет.</p>
</dd>
<dt class="hdlist1"><a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/Sequence.html">Sequence</a></dt>
<dd>
<p>предназначен для работы с последовательностями.
Наследует все методы класса <code>BasicDataAccessor</code> и добавляет метод <code>nextValue</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Ниже описываются методы класса <code>Cursor</code>, но те методы, которые унаследованы от <code>BasicCursor</code> (и могут применяться при работе с представлениями и неизменяемыми таблицами) отмечены значком <span class="icon"><i class="fa fa-search"></i></span>.</p>
</div>
<div class="sect2">
<h3 id="_метаданные_о_полях_курсора">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%B0%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BE_%D0%BF%D0%BE%D0%BB%D1%8F%D1%85_%D0%BA%D1%83%D1%80%D1%81%D0%BE%D1%80%D0%B0"></a>1.1. Метаданные о полях курсора</h3>
<div class="paragraph">
<p>Для вызова ряда методов работы с данными курсора, а также для удобства получения информации о том, какие поля присутствуют в каждом из курсоров, на каждый из классов -курсоров также кодогенерируется класс-компаньон <code>Columns</code>.
Класс-компаньон является статическим вложенным классов курсора.
Например, для класса <code>FooCursor</code> компаньоном является <code>FooCursor.Columns</code>.</p>
</div>
<div class="paragraph">
<p>Каждому полю курсора соответствует метод в классе <code>Columns</code>, возвращающий <a href="#Celesta_metadata">метаданные</a> соответствующей колонки, как показано на диаграмме:</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="_images/diag-70c781212b40669b10debe3176634c9dcf9ce0ef.png" alt="cursormeta">
</div>
</div>
<div class="paragraph">
<p>В каждом экземпляре курсора соответствующий экземпляр класса <code>Columns</code> доступен через <code>public final</code> поле <code>COLUMNS</code>.
Кроме того, класс <code>Columns</code> каждого из курсоров может быть проинстанцирован независимо от курсора — его конструктор принимает параметр <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/ICelesta.html"><code>ICelesta</code></a>.</p>
</div>
<div class="paragraph">
<p>Использование методов класса <code>Columns</code>, получаемого кодогенерацией, для получения ссылок на поля таблиц, гарантирует целостность кода при изменении схемы данных (например, при удалении или переименовании полей в базе данных).</p>
</div>
</div>
<div class="sect2">
<h3 id="_конструктор_курсора">
<a class="anchor" href="#_%D0%BA%D0%BE%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D0%BE%D1%80_%D0%BA%D1%83%D1%80%D1%81%D0%BE%D1%80%D0%B0"></a>1.2. Конструктор курсора</h3>
<div class="paragraph">
<p>Конструктор каждого курсора принимает в себя параметр <code>CallContext context</code>, который, в свою очередь, выдаётся каждому методу сервисного слоя при начале работы.
Использование context-а позволяет работать с разными таблицами системы в одной транзакции и затем единым образом коммитить все изменения, кроме того, переменная context содержит информацию о текущем пользователе, используемую системами логирования и разграничения прав доступа.</p>
</div>
<div class="paragraph">
<p>Так, для курсоров типов <code>Cursor</code>, <code>ViewCursor</code>, <code>MaterializedViewCursor</code>, <code>ReadOnlyTableCursor</code> конструктор может вызываться следующим образом.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ACursor a = new ACursor(context);</code></pre>
</div>
</div>
<div id="too_many_accessors_warning" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Внимание"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Максимальное количество курсоров, которое можно создать с помощью одного экземпляра <code>CallContext</code>, равно 1023.
При превышении этого значения возникает ошибка "Too many data accessors".</p>
</div>
<div class="paragraph">
<p>Это не ограничивает разумные сценарии работы с данными в базе данных, но предотвращает утечку JDBC-ресурсов, если, например, курсоры создаются в цикле.
При создании курсора внутри цикла, его необходимо явным образом закрывать.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="limit_columns">
<a class="anchor" href="#limit_columns"></a>1.2.1. Ограничение столбцов в выборке</h4>
<div class="paragraph">
<p>Очень часто в таблице определено много полей, но для нужд работы требуется лишь малая часть из них.
Чтобы не передавать лишнюю информацию между базой и сервером приложений и увеличить быстродействие, курсоры можно создавать таким образом, чтобы получать из БД значения только нужных столбцов.
Для этого в опциональные varargs-параметры конструктора курсора требуется передать перечень полей, которые требуется извлекать.
Поля, не указанные в этом перечне, будут при навигации курсора по записям в базе данных принимать значение <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Допустим, что в БД имеется заполненная данными таблица table1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">create table table1 (
  id int not null primary key,
  numb int not null,
  numb2 int,
  varr varchar(2) not null
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Допустим, что в создаваемом разработчиком решении, нет необходимости в выборке данных из столбца varr.
В этом случае при создании курсора можно указать список столбцов, которые необходимы.
Создание такого курсора будет выглядеть так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//инстанцируем объект-компаньон с информацией о столбцах
Table1Cursor.Columns columns = new Table1Cursor.Columns(context.getCelesta());
//передаём в дополнительных аргументах конструктора перечень желаемых столбцов
Table1Cursor tableCursor = new Table1Cursor(context, columns.numb(), columns.numb2());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь при любом запросе данных из БД celesta не будет выбирать столбец <code>varr</code>, а в курсоре <code>tableCursor</code> поле <code>varr</code> всегда будет иметь значение <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Некоторые особенности ограничения столбцов в выборке:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Колонки, являющиеся частью первичного ключа, всегда будут попадать в курсор из БД, независимо от того, указаны они в списке необходимых полей или нет.
Это сделано для корректной работы метода navigate курсоров при ограничении колонок.</p>
</li>
<li>
<p>Колонки, являющиеся частью group by выражения материализованных представлений (materialized view) всегда будут попадать в курсор из БД.</p>
</li>
<li>
<p>При передаче пустого списка полей или при его отсутствии будут выбираться все колонки.</p>
</li>
<li>
<p>Использование столбцов с типом <a href="#BLOB_fields"><code>BLOB</code></a> не изменяется.
По умолчанию данные из этих полей никогда не читаются из базы данных в процессе навигации, данные из них всегда можно получать вызовом отдельного метода.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_передача_параметров_в_функции">
<a class="anchor" href="#_%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B0_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8"></a>1.2.2. Передача параметров в функции</h4>
<div class="paragraph">
<p>Стоит отметить, что курсор <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/ParameterizedViewCursor.html"><code>ParameterizedViewCursor</code></a> имеет собственную версию конструктора, принимающую набор именованных аргументов — параметров функции.</p>
</div>
<div class="paragraph">
<p>Допустим, имеется таблица и функция для выборки из нее.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE table t1 (
  id INT NOT NULL IDENTITY PRIMARY KEY,
  f1 int,
  f2 int,
  f3 VARCHAR (2)
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE FUNCTION pView1(p int) AS
  select sum (f1) as sumv, f3 as f3
  from t1 as t1
  where f2 = $p
  group by f3;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Тогда для создания курсора для функции с параметром p = 5 необходимо выполнить следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PView1Cursor pView1 = new PView1Cursor(context, 5);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Передачу параметров функции можно комбинировать с ограничением полей выборки: для этого сначала надо в обязательных аргументах курсора перечислить параметры, а затем в varargs-аргументах передать перечень полей, которые вы хотите выбрать.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_изменение_полей_курсора">
<a class="anchor" href="#_%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9_%D0%BA%D1%83%D1%80%D1%81%D0%BE%D1%80%D0%B0"></a>1.3. Изменение полей курсора</h3>
<div class="paragraph">
<p>По количеству объявленных полей таблицы в классе курсора имеются поля с геттерами и сеттерами, позволяющие читать и записывать информацию.
Так, если таблица foo определена следующим образом</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE foo (
  a INT NOT NULL PRIMARY KEY,
  b VARCHAR(10),
  c DATETIME,
  d BIT
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>то для того, чтобы вставить запись в таблицу foo, можно использовать следующий код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FooCursor foo = new FooCursor(context);
foo.setA(1);
foo.setB("text");
foo.setC(new GregorianCalendar(year, month, day).getTime());
foo.insert();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Соответствие между типами данных CelestaSQL и Java-типами приведено в <a href="1050_celesta_sql.html#datatypes_mapping">таблице</a>.</p>
</div>
<div class="paragraph">
<p>Обратите внимание на использование класса <code>Date</code> для записи значений даты: это ограничение JDBC API.
При необходимости заполнить поле "с" текущей датой и временем, это можно было бы сделать при помощи выражения</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">foo.setC(new Date());</code></pre>
</div>
</div>
<div class="paragraph">
<p>То, как изменить значение BLOB-поля, описано в разделе <a href="#BLOB_fields">BLOB-поля</a>.</p>
</div>
<div class="paragraph">
<p>Отдельный атрибут <code>getRecversion()</code> в курсоре существует для значения системного поля recversion, необходимого для механизма <a href="1110_lost_updates_protection.html#Lost_updates_protection">защиты от потерянных обновлений</a>.</p>
</div>
<div class="paragraph">
<p>Каждый курсор имеет следующие методы (значком <span class="icon"><i class="fa fa-search"></i></span> обозначены методы, унаследованные от <code>BasicCursor</code>, которые могут применяться при работе с представлениями и таблицами «только на чтение»):</p>
</div>
</div>
<div class="sect2">
<h3 id="_закрытие_курсора">
<a class="anchor" href="#_%D0%B7%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5_%D0%BA%D1%83%D1%80%D1%81%D0%BE%D1%80%D0%B0"></a>1.4. Закрытие курсора</h3>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>close()</strong> — закрытие курсора (реализует метод <code>close</code> интерфейса <code>java.io.Closeable</code>).
Данный метод высвобождает все JDBC-ресурсы, аллоцированные во время существования курсора.
Обращение к методам закрытого курсора приведёт к ошибке.
Данный метод вызывать не обязательно, т. к. он вызывается автоматически после закрытия <code>CallContext</code> на всех курсорах, созданных с его помощью.
Вообще, предпочтительной практикой программирования является создание как можно меньшего числа курсоров в процедуре и повторное их использование.
Тем не менее, если есть необходимость в создании большого числа курсоров, то возникает необходимость и в использовании метода <code>close()</code> в тот самый момент, когда экземпляр курсора становится ненужным.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_методы_переходов_по_записям">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%BE%D0%B2_%D0%BF%D0%BE_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8F%D0%BC"></a>1.5. Методы переходов по записям</h3>
<div class="ulist">
<ul>
<li>
<p><strong>tryGet(…​)</strong> Осуществляет поиск записи по ключевым полям, возвращает <code>true</code>, если запись найдена, и <code>false</code>, если записи с таким первичным ключом нет в таблице.
В аргументах этого метода должны быть перечислены значения полей первичного ключа, количество аргументов должно быть равно количеству полей первичного ключа таблицы.</p>
</li>
<li>
<p><strong>get(…​)</strong> То же, что <code>tryGet</code>, но выбрасывает исключение, если запись не найдена.</p>
</li>
<li>
<p><strong>tryGetCurrent()</strong>  Извлекает из базы данных запись по текущим значениям полей первичного ключа.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Внимание"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Методы <code>get</code>, <code>tryGet</code> and <code>tryGetCurrent</code> не учитывает никаких фильтров, наложенных на таблицу.
Если вам необходимо найти запись с учётом фильтров, то используйте метод <code>[try]First</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>navigate(command)</strong> — осуществляет переход по записям относительно текущего положения.
Возвращает <code>true</code>, если переход удачный, и <code>false</code> — если записи не оказалось.
При этом строка <code>command</code> может представлять собой произвольный набор из следующих символов-команд, выполняемых одна за другой до тех пор, пока запись не нашлась (или набор команд не исчерпался):</p>
<div class="ulist">
<ul>
<li>
<p>- (минус) — переход к первой записи, удовлетворяющей условиям сортировки и фильтрации,</p>
</li>
<li>
<p>+ (плюс) — переход к последней записи,</p>
</li>
<li>
<p>&gt; — переход к следующей записи, относительно текущей, удовлетворяющей условиям сортировки и фильтрации,</p>
</li>
<li>
<p>&lt; — переход к предыдущей записи,</p>
</li>
<li>
<p>= — обновление текущей записи, если она попадает в текущий фильтр.</p>
</li>
</ul>
</div>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>tryFirst()</strong> — то же, что <code>navigate('-')</code>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>first()</strong> — то же, что <code>tryFirst()</code>, но вызывает ошибку, если запись не найдена.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>tryLast()</strong> — то же, что <code>navigate('+')</code>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>last()</strong> — то же, что <code>tryLast()</code>, но вызывает ошибку, если запись не найдена.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>next()</strong> — то же, что <code>navigate('&gt;')</code>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>previous()</strong> — то же, что <code>navigate('&lt;')</code>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>tryFindSet()</strong> — открывает набор записей (<code>ResultSet</code>) и устанавливает курсор в его начало.
Возвращает <code>true</code>, если открывшийся набор не пуст, <code>false</code> — если записей в наборе нет.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>findSet()</strong> — то же, что <code>tryFindSet()</code>, но вызывает ошибку в случае, если переход неудачен.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>nextInSet()</strong> — переход к следующей записи в текущем наборе записей.
Если набор не открыт, вызов этого метода эквивалентен вызову <code>tryFindSet()</code>.
Возвращает <code>true</code>, если переход состоялся, <code>false</code> — если достигнут конец набора.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>iterator()</strong> — возвращает итератор, позволяющий осуществить полную итерацию по набору записей с первой до последней.
Реализует соответствующий метод интерфейса <code>java.lang.Iterable</code>.
Например, если переменная <code>rec</code> содержит экземпляр курсора, то полная итерация с использованием метода <code>iterate()</code> может быть осуществлена следующим образом:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"> for (FooCursor r: rec): {
         /* здесь внутри цикла всё,
          что вы хотите сделать с записями r */
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>что будет полностью эквивалентно следующему коду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">if (cursor.tryFindSet()) {
    while (cursor.nextInSet()) {
        //цикл
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Замечание"></i>
</td>
<td class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><em>В чём разница между <code>[try]First()</code> и <code>[try]FindSet()</code>?</em></dt>
<dd>
<p>Разница в отправляемом на БД запросе. <code>[try]First()</code> (а также <code>navigate()</code>, <code>next()</code>, <code>last()</code>…​) выполняет запрос вида <code>SELECT TOP 1</code>, запрашивают одну запись и сразу закрывают JDBC ResultSet.
Метод <code>findSet()</code> открывает ResultSet и держит его для того, чтобы его можно было бы обойти при помощи метода <code>iterate()</code>.</p>
</dd>
<dt class="hdlist1"><em>Чем <code>navigate("=")</code> отличается от <code>tryGetCurrent()</code>?</em></dt>
<dd>
<p>Метод <code>navigate()</code> учитывает текущие фильтры, а <code>get</code>-методы — не учитывают.
Запись с текущим значением первичного ключа может не попасть в фильтр, поэтому <code>navigate('=')</code> может вернуть <code>false</code> в ситуации, когда <code>tryGetCurrent()</code> возвращает <code>true</code>.</p>
</dd>
<dt class="hdlist1"><em>Что значит <code>navigate("=&gt;&lt;")</code>?</em></dt>
<dd>
<p>Эта команда предписывает следующий алгоритм: "Попытайся найти текущую запись.
Если запись нашлась, выйди и верни <code>true</code>.
Если записи уже нет (удалили), сходи вперёд.
Если запись нашлась, выйди и верни <code>true</code>.
Если впереди ничего нет, сходи назад.
Если запись нашлась, верни <code>true</code>, если нет — <code>false</code>.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_методы_сортировки_и_фильтрации">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D1%81%D0%BE%D1%80%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8_%D0%B8_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8"></a>1.6. Методы сортировки и фильтрации</h3>
<div id="set_range_usage" class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setRange(ColumnMeta&lt;?&gt; column)</strong> Сброс любого фильтра на поле.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setRange(ColumnMeta&lt;? super T&gt; column, T value)</strong> Установка диапазона из единственного значения на поле.
Передача значения <code>null</code> в качестве аргумента приводит к установке фильтра 'IS NULL' на данное поле.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setRange(ColumnMeta&lt;? super T&gt; column, T valueFrom, T valueTo)</strong> Установка диапазона «от..до включительно» на поле (на уровне языка SQL соответствует оператору BETWEEN).
Использование <code>null</code> в качестве аргумента не допускается.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setFilter(ColumnMeta&lt;?&gt; column, String value)</strong> Установка фильтра на поле, описание выражений сложных фильтров приведено  <a href="#setFilter_usage">ниже</a>.</p>
</li>
</ul>
</div>
<div id="set_complex_filter_usage" class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setComplexFilter(String value)</strong> Установка сложного фильтра на таблицу.
Аргумент соответствует условию <code>WHERE</code> запроса на языке CelestaSQL.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>setIn(BasicCursor auxiliaryCursor)</strong> Установка фильтра с вложенным запросом.
Описание использования <code>setIn</code> приведено <a href="#setIn_usage">ниже</a>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>limit(long skip, long limit)</strong> Установка ограничений на возвращаемый диапазон строк.
В качестве параметров должны быть неотрицательные целые числа.
Параметр <code>skip</code> означает количество строк, которое будет пропущено перед тем, как начнётся выдача (<code>skip = 0</code> — выдача с самого начала), <code>limit</code> — максимальное число возвращаемых строк, при этом <code>limit = 0</code> означает возврат <strong>всех</strong> строк.
Вызов <code>limit(0, 0)</code> сбрасывает ограничения на возвращаемый диапазон набора строк.
Ограничения, установленные методом <code>limit()</code>, не учитываются при вызове метода <code>count()</code>.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>orderBy(ColumnMeta&lt;?&gt;…​ columns)</strong> Установка сортировки.
Параметры — перечень полей для сортировки.
Чтобы указывать сортировку по возрастанию или по убыванию, необходимо для соответствующего поля воспользоваться методом <code>asc()</code> или <code>desc()</code>.
Если метод <code>asc()</code> или <code>desc()</code> не был вызван явно, сортировка идёт по возрастанию.
Допускается вызов <strong>orderBy()</strong> без аргументов, чтобы сбросить все установленные ранее сортировки на сортировку по умолчанию.
Поле можно указать не более чем в одном из аргументов метода <strong>orderBy(…​)</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Следует помнить, что в Celesta не бывает не отсортированных наборов данных: по умолчанию наборы данных в Celesta всегда сортируются по полям первичного ключа, а к любому набору полей, заданному через <code>orderBy(…​)</code>, Celesta автоматически добавляет в конец те поля первичного ключа, которые не были перечислены в аргументах.
Для представлений и <code>WITH READ ONLY</code> таблиц, у которых поля первичного ключа не заданы, Celesta использует для сортировки по умолчанию <strong>первое поле</strong>.
Всё это реализовано для того, чтобы итерация по записям курсора была детерминированной.</p>
</div>
</div>
<div class="sect2">
<h3 id="_методы_инициализации">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D0%B8%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8"></a>1.7. Методы инициализации</h3>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>reset()</strong> Сброс фильтров и сортировки, с сохранением значений полей буфера.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>clear()</strong> Сброс фильтров, сортировки и полная очистка буфера, включая ключевые поля.</p>
</li>
<li>
<p><strong>init()</strong> Очистка всех полей буфера, кроме ключевых.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_методы_клонирования">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D0%BA%D0%BB%D0%BE%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F"></a>1.8. Методы клонирования</h3>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>copyFiltersFrom(BasicCursor c)</strong> Перенос значений всех фильтров, включая значения limit (skip и limit), из курсора с тем же типом в текущий курсор.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>copyOrderFrom(BasicCursor c)</strong> Перенос настроек сортировки из курсора с тем же типом в текущий курсор.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>copyFieldsFrom(BasicCursor c)</strong> Перенос значений всех полей из курсора с тем же типом в текущий курсор.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_методы_модификации_данных">
<a class="anchor" href="#_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D0%BC%D0%BE%D0%B4%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85"></a>1.9. Методы модификации данных</h3>
<div class="ulist">
<ul>
<li>
<p><strong>insert()</strong> Вставка содержимого курсора в БД.
При этом если запись с таким первичным ключом уже существует, возникает ошибка.</p>
</li>
<li>
<p><strong>tryInsert()</strong> Вставка содержимого курсора в БД. <code>true</code> если получилось, <code>false</code> если запись с таким первичным ключом уже существует</p>
</li>
<li>
<p><strong>update()</strong> Сохранение содержимого курсора в БД, выбрасывая исключение в случае, если запись с такими ключевыми полями не найдена.</p>
</li>
<li>
<p><strong>tryUpdate()</strong> Сохранение содержимого курсора в БД, <code>true</code> если получилось, <code>false</code> если запись с таким первичным ключом не существует.</p>
</li>
<li>
<p><strong>delete()</strong> Удаление текущей записи.</p>
</li>
<li>
<p><strong>deleteAll()</strong> Удаление всех записей, попадающих в фильтр.
Внимание: триггер <code>onDelete</code> при этом не вызывается.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_вспомогательные_методы">
<a class="anchor" href="#_%D0%B2%D1%81%D0%BF%D0%BE%D0%BC%D0%BE%D0%B3%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B"></a>1.10. Вспомогательные методы</h3>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>canRead(), canInsert(), canModify(), canDelete()</strong> Возвращает булевское значение, указывающее на наличие прав у текущей сессии на выполнение соответствующей операции.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>count()</strong> Возвращает количество записей в отфильтрованном наборе.
В частности, если фильтров на курсор не установлено, возвращает полное количество записей в таблице.
Ограничения на набор записей, установленные методом limit(), не учитываются при вызове метода count().</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>callContext()</strong> Возвращает контекст вызова, на котором создан данный курсор.</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>meta()</strong> Возвращает описание таблицы или представления (метаинформацию, экземпляр класса org.javacc.test.celesta.Table/View).</p>
</li>
<li>
<p><span class="icon"><i class="fa fa-search"></i></span> <strong>asCSVLine()</strong> Возвращает значение полей курсора в виде CSV-строки с разделителями-запятыми.</p>
</li>
<li>
<p><strong>getMaxStrLen(ColumnMeta&lt;String&gt;)</strong> Возвращает длину текстового поля (в символах).
Метод необходим для определения длины, до которой необходимо обрезать строку, передаваемую в базу данных.
Возвращает -1, если поле определено как TEXT.</p>
</li>
<li>
<p><strong>getXRec()</strong> Возвращает <a href="1107_xrec.html#xrec_section">копию буфера</a>, содержащую значения, полученные при последнем чтении данных из базы.</p>
</li>
</ul>
</div>
<div id="try_method_notice" class="paragraph">
<p>Обратите внимание, что методы <code>get</code>, <code>first</code>, <code>insert</code>, <code>update</code> имеют два варианта: без приставки <code>try</code> (просто <code>get(…​)</code> и т. д.) и с приставкой <code>try</code> (<code>tryGet(…​)</code>, <code>tryFirst(…​)</code> и т. д.).</p>
</div>
<div class="paragraph">
<p>Методы без приставки <code>try</code> вызывают исключение, если в базе данных нет подходящих данных для выполнения действия.
К примеру, <code>first()</code> вызовет исключение, если в установленный на курсор фильтр не попадёт ни одной записи (или, в вырожденном случае, если таблица окажется пуста).
Методы <code>get</code> и <code>update</code> вызовут исключение в случае отсутствия соответствующей записи, а метод <code>insert</code> — если запись с таким набором значений полей первичного ключа уже существует.
В то же время методы с приставкой <code>try</code> исключения не вызывают, а вместо этого возвращают булевское значение, сигнализирующее об успешности или неуспешности соответствующей операции.</p>
</div>
<div class="paragraph">
<p>Правильной практикой при разработке кода бизнес-логики является использование методов БЕЗ приставки <code>try</code> везде, где это возможно.
Таким образом создаётся «самотестирующийся» код, вовремя сигнализирующий об ошибках в логике и/или в данных базы данных.
К примеру, если при разработке процедуры мы предполагаем, что если приложение работает верно, то в переменной <code>idFoo</code> содержится идентификатор записи, существующей в таблице <code>foo</code>, то для получения самой записи следует писать <code>foo.get(idFoo)</code>.
В этом случае, если где-то в программе есть ошибка, приводящая к тому, что idFoo может принимать значение несуществующего идентификатора, об этом будут проинформированы разработчики и пользователи в самый момент возникновения данной ситуации.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Внимание"></i>
</td>
<td class="content">
<div class="paragraph">
<p>«Маскировка» возможных проблем путём использования <code>try</code>…​-метода без явной нужды в возвращаемом значении этого метода может привести к общему запутыванию отладки и дестабилизации кода.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Разумеется, иногда в коде нужно выяснить — есть ли запись с таким идентификатором? Для этого — и только для этого — предназначен <code>tryGet</code>, аналогичное справедливо для других «<code>try</code>-методов», использование которых в подавляющем большинстве случаев оправдано только если предполагается явное использование возвращаемых значений этих методов.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setFilter_usage">
<a class="anchor" href="#setFilter_usage"></a>2. Использование метода setFilter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В большинстве практических случаев фильтрацию курсоров по значению поля можно выполнять при помощи методов <code>setRange(…​)</code> с двумя или тремя параметрами, отфильтровывающих значения по условию вида «поле = значение» либо по условию вида «поле between значение1 and значение2».</p>
</div>
<div class="paragraph">
<p>В случаях, когда простого сравнения или условия between недостаточно, метод <code>setFilter</code> позволяет наложить более сложное условие на значения в одном из полей курсора.
Первым аргументом метода <code>setFilter</code> является поле, а вторым — выражение фильтра.</p>
</div>
<div class="paragraph">
<p>Правильное выражение фильтра может состоять из:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>числовых либо текстовых литералов (в зависимости от типа поля),</p>
</li>
<li>
<p>литерала <code>null</code>,</p>
</li>
<li>
<p>логических операторов &amp;, |, !,</p>
</li>
<li>
<p>операторов сравнения &lt;, &gt;, ..,</p>
</li>
<li>
<p>группирующих скобок (, ),</p>
</li>
<li>
<p>специальных операторов @ и % для текстовых полей.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Выражение фильтра не может быть <code>null</code> или пустой строкой, для сброса фильтра с поля следует вызывать метод <code>setRange()</code> без параметров.
Пробелы между литералами и операторами игнорируются.
Выражение фильтра напрямую, без какой-либо оптимизации, транслируется в условие для выражения <code>WHERE</code> языка SQL.</p>
</div>
<div class="sect2">
<h3 id="_выражения_фильтра_для_полей_с_типами_bit_и_blob">
<a class="anchor" href="#_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9_%D1%81_%D1%82%D0%B8%D0%BF%D0%B0%D0%BC%D0%B8_bit_%D0%B8_blob"></a>2.1. Выражения фильтра для полей с типами BIT и BLOB</h3>
<div class="paragraph">
<p>Для полей с типами BIT и BLOB допустимо использование выражения фильтров вида null и !null, отфильтровывающие значения «поле is null» и «not (поле is null)»:</p>
</div>

        <div id="bit_blob_filter" class="imageblock">
          <div class="content">
            <object type="image/svg+xml" data="create_schema.svg" width="253" height="111" version="1.0" encoding="UTF-8" standalone="no">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" height="111" preserveaspectratio="xMidYMid meet" xml:space="preserve" version="1.1" viewbox="0 0 253 111" width="253">
<style type="text/css">
<![CDATA[
.title_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:20pt; font-weight:normal; font-style:normal; }
.literal_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.token_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:16pt; font-weight:normal; font-style:normal; }
.box_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.bubble_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.label {fill: #000; text-anchor:middle; font-size:16pt; font-weight:bold; font-family:Sans;}
.link {fill: #0D47A1;}
.link:hover {fill: #0D47A1; text-decoration:underline;}
.link:visited {fill: #4A148C;}
]]>
</style>
<defs>
<marker id="arrow" markerheight="4" markerunits="strokeWidth" markerwidth="5" orient="auto" refx="2.5" refy="2">
<path d="M0,0 L0.5,2 L0,4 L4.5,2 z" fill="#000000"></path>
</marker>
</defs>
<rect fill="white" height="100%" width="100%"></rect>
<circle cx="13" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<path d="M86,79 A15,15 0 0,1 86,49 H93 A15,15 0 0,1 93,79 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="89" y="69">!</text>
<line stroke="#000000" stroke-width="2" x1="89" x2="90" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="33" x2="71" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="108" x2="147" y1="63" y2="63"></line>
<path d="M52,82 A19,19 0 0,0 33,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="71" x2="85" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="90" x2="108" y1="101" y2="101"></line>
<path d="M52,82 A19,19 0 0,0 71,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M108,101 A19,19 0 0,0 127,82" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M146,63 A19,19 0 0,0 127,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="52" x2="52" y1="82" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="127" x2="127" y1="82" y2="82"></line>
<path d="M177,78 A14,14 0 0,1 177,50 H206 A14,14 0 0,1 206,78 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="bubble_font" x="191" y="69">null</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="145" x2="159" y1="63" y2="63"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="15" x2="29" y1="63" y2="63"></line>
<circle cx="240" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="219" x2="233" y1="63" y2="63"></line>
<text class="title_font" x="110" y="28">bit_blob_filter</text>
</svg>

            </object>
          </div>
        </div>
<div class="paragraph">
<p>Иные виды фильтрации для типа BLOB смысла не имеют, а для битового типа условие на <code>true</code> или <code>false</code> накладывается с помощью метода <strong>setRange(…​)</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_выражения_фильтра_для_полей_с_типами_integer_и_real">
<a class="anchor" href="#_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9_%D1%81_%D1%82%D0%B8%D0%BF%D0%B0%D0%BC%D0%B8_integer_%D0%B8_real"></a>2.2. Выражения фильтра для полей с типами INTEGER и REAL</h3>
<div class="paragraph">
<p>Для полей с типами INTEGER и REAL допустимо использование выражений фильтров по следующим синтаксическим правилам:</p>
</div>

        <div id="filter" class="imageblock">
          <div class="content">
            <object type="image/svg+xml" data="create_schema.svg" width="486" height="205" version="1.0" encoding="UTF-8" standalone="no">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" height="205" preserveaspectratio="xMidYMid meet" xml:space="preserve" version="1.1" viewbox="0 0 486 205" width="486">
<style type="text/css">
<![CDATA[
.title_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:20pt; font-weight:normal; font-style:normal; }
.literal_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.token_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:16pt; font-weight:normal; font-style:normal; }
.box_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.bubble_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.label {fill: #000; text-anchor:middle; font-size:16pt; font-weight:bold; font-family:Sans;}
.link {fill: #0D47A1;}
.link:hover {fill: #0D47A1; text-decoration:underline;}
.link:visited {fill: #4A148C;}
]]>
</style>
<defs>
<marker id="arrow" markerheight="4" markerunits="strokeWidth" markerwidth="5" orient="auto" refx="2.5" refy="2">
<path d="M0,0 L0.5,2 L0,4 L4.5,2 z" fill="#000000"></path>
</marker>
</defs>
<rect fill="white" height="100%" width="100%"></rect>
<circle cx="13" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<path d="M105,79 A15,15 0 0,1 105,49 H112 A15,15 0 0,1 112,79 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="108" y="69">!</text>
<line stroke="#000000" stroke-width="2" x1="108" x2="109" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="52" x2="90" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="127" x2="166" y1="63" y2="63"></line>
<path d="M71,82 A19,19 0 0,0 52,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="90" x2="104" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="109" x2="127" y1="101" y2="101"></line>
<path d="M71,82 A19,19 0 0,0 90,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M127,101 A19,19 0 0,0 146,82" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M165,63 A19,19 0 0,0 146,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="71" x2="71" y1="82" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="146" x2="146" y1="82" y2="82"></line>
<rect fill="#ffffff" fill-opacity="1.0" height="28" stroke="#000000" stroke-width="2" width="57" x="230" y="50"></rect>
<text class="box_font" x="258" y="69">term</text>
<path d="M245,117 A15,15 0 0,1 245,87 H252 A15,15 0 0,1 252,117 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="248" y="107">(</text>
<rect fill="#ffffff" fill-opacity="1.0" height="28" stroke="#000000" stroke-width="2" width="58" x="284" y="88"></rect>
<text class="box_font" x="313" y="107">filter</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="266" x2="280" y1="101" y2="101"></line>
<path d="M374,117 A15,15 0 0,1 374,87 H381 A15,15 0 0,1 381,117 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="377" y="107">)</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="341" x2="355" y1="101" y2="101"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="182" x2="226" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="287" x2="445" y1="63" y2="63"></line>
<path d="M201,82 A19,19 0 0,0 182,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="220" x2="226" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="396" x2="406" y1="101" y2="101"></line>
<path d="M201,82 A19,19 0 0,0 220,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M406,101 A19,19 0 0,0 425,82" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M444,63 A19,19 0 0,0 425,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="201" x2="201" y1="82" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="425" x2="425" y1="82" y2="82"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="164" x2="178" y1="63" y2="63"></line>
<path d="M222,156 A15,15 0 0,1 222,126 H235 A15,15 0 0,1 235,156 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="228" y="146">&amp;</text>
<path d="M226,195 A15,15 0 0,1 226,165 H232 A15,15 0 0,1 232,195 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="229" y="185">|</text>
<line stroke="#000000" stroke-width="2" x1="163" x2="207" y1="140" y2="140"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="296" x2="254" y1="140" y2="140"></line>
<path d="M182,159 A19,19 0 0,0 163,140" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="201" x2="211" y1="179" y2="179"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="257" x2="251" y1="179" y2="179"></line>
<path d="M182,160 A19,19 0 0,0 201,179" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M257,179 A19,19 0 0,0 276,160" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M295,140 A19,19 0 0,0 276,159" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="182" x2="182" y1="160" y2="159"></line>
<line stroke="#000000" stroke-width="2" x1="276" x2="276" y1="160" y2="159"></line>
<line stroke="#000000" stroke-width="2" x1="52" x2="163" y1="140" y2="140"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="444" x2="299" y1="140" y2="140"></line>
<line stroke="#000000" stroke-width="2" x1="33" x2="52" y1="63" y2="63"></line>
<path d="M52,63 A9,9 0 0,0 43,72" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="43" x2="43" y1="131" y2="105"></line>
<line stroke="#000000" stroke-width="2" x1="43" x2="43" y1="101" y2="72"></line>
<path d="M43,131 A9,9 0 0,0 52,140" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M453,72 A9,9 0 0,0 444,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="453" x2="453" y1="72" y2="97"></line>
<line stroke="#000000" stroke-width="2" x1="453" x2="453" y1="101" y2="131"></line>
<path d="M444,140 A9,9 0 0,0 453,131" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="444" x2="453" y1="63" y2="63"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="15" x2="29" y1="63" y2="63"></line>
<circle cx="473" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="452" x2="466" y1="63" y2="63"></line>
<text class="title_font" x="61" y="28">filter</text>
</svg>

            </object>
          </div>
        </div>
<div class="paragraph">
<p>Здесь</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp; — знак логического И,</p>
</li>
<li>
<p>| — знак логического ИЛИ,</p>
</li>
<li>
<p>! — знак логического НЕ,</p>
</li>
<li>
<p>(, ) — группирующие скобки.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Выражение <strong>term</strong> для числовых полей имеет следующий синтаксис:</p>
</div>

        <div id="filter_numeric_term" class="imageblock">
          <div class="content">
            <object type="image/svg+xml" data="create_schema.svg" width="716" height="275" version="1.0" encoding="UTF-8" standalone="no">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" height="275" preserveaspectratio="xMidYMid meet" xml:space="preserve" version="1.1" viewbox="0 0 716 275" width="716">
<style type="text/css">
<![CDATA[
.title_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:20pt; font-weight:normal; font-style:normal; }
.literal_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.token_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:16pt; font-weight:normal; font-style:normal; }
.box_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.bubble_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.label {fill: #000; text-anchor:middle; font-size:16pt; font-weight:bold; font-family:Sans;}
.link {fill: #0D47A1;}
.link:hover {fill: #0D47A1; text-decoration:underline;}
.link:visited {fill: #4A148C;}
]]>
</style>
<defs>
<marker id="arrow" markerheight="4" markerunits="strokeWidth" markerwidth="5" orient="auto" refx="2.5" refy="2">
<path d="M0,0 L0.5,2 L0,4 L4.5,2 z" fill="#000000"></path>
</marker>
</defs>
<rect fill="white" height="100%" width="100%"></rect>
<circle cx="13" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<path d="M95,78 A14,14 0 0,1 95,50 H124 A14,14 0 0,1 124,78 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="bubble_font" x="109" y="69">null</text>
<path d="M88,116 H218 L225,102 L218,88 H88 L81,102 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="153" y="107">numeric literal</text>
<path d="M295,117 A15,15 0 0,1 295,87 H307 A15,15 0 0,1 307,117 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="301" y="107">..</text>
<path d="M384,116 H514 L521,102 L514,88 H384 L377,102 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="449" y="107">numeric literal</text>
<line stroke="#000000" stroke-width="2" x1="448" x2="449" y1="139" y2="139"></line>
<line stroke="#000000" stroke-width="2" x1="339" x2="377" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="521" x2="560" y1="101" y2="101"></line>
<path d="M358,120 A19,19 0 0,0 339,101" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="377" x2="444" y1="139" y2="139"></line>
<line stroke="#000000" stroke-width="2" x1="449" x2="521" y1="139" y2="139"></line>
<path d="M358,120 A19,19 0 0,0 377,139" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M521,139 A19,19 0 0,0 540,120" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M559,101 A19,19 0 0,0 540,120" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="358" x2="358" y1="120" y2="120"></line>
<line stroke="#000000" stroke-width="2" x1="540" x2="540" y1="120" y2="120"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="321" x2="335" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="428" x2="429" y1="148" y2="148"></line>
<line stroke="#000000" stroke-width="2" x1="242" x2="280" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="559" x2="617" y1="101" y2="101"></line>
<path d="M261,120 A19,19 0 0,0 242,101" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="280" x2="424" y1="148" y2="148"></line>
<line stroke="#000000" stroke-width="2" x1="429" x2="578" y1="148" y2="148"></line>
<path d="M261,129 A19,19 0 0,0 280,148" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M578,148 A19,19 0 0,0 597,129" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M616,101 A19,19 0 0,0 597,120" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="261" x2="261" y1="129" y2="120"></line>
<line stroke="#000000" stroke-width="2" x1="597" x2="597" y1="129" y2="120"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="224" x2="238" y1="101" y2="101"></line>
<path d="M144,187 A15,15 0 0,1 144,157 H156 A15,15 0 0,1 156,187 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="150" y="177">..</text>
<path d="M144,226 A15,15 0 0,1 144,196 H158 A15,15 0 0,1 158,226 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="151" y="216">&gt;</text>
<path d="M144,265 A15,15 0 0,1 144,235 H158 A15,15 0 0,1 158,265 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="151" y="255">&lt;</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="81" x2="125" y1="171" y2="171"></line>
<line stroke="#000000" stroke-width="2" x1="171" x2="222" y1="171" y2="171"></line>
<path d="M100,190 A19,19 0 0,0 81,171" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="119" x2="125" y1="210" y2="210"></line>
<line stroke="#000000" stroke-width="2" x1="173" x2="183" y1="210" y2="210"></line>
<path d="M100,191 A19,19 0 0,0 119,210" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M183,210 A19,19 0 0,0 202,191" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="119" x2="125" y1="249" y2="249"></line>
<line stroke="#000000" stroke-width="2" x1="173" x2="183" y1="249" y2="249"></line>
<path d="M100,230 A19,19 0 0,0 119,249" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M183,249 A19,19 0 0,0 202,230" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M221,171 A19,19 0 0,0 202,190" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="100" x2="100" y1="230" y2="190"></line>
<line stroke="#000000" stroke-width="2" x1="202" x2="202" y1="230" y2="190"></line>
<path d="M245,186 H375 L382,172 L375,158 H245 L238,172 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="310" y="177">numeric literal</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="220" x2="234" y1="171" y2="171"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="33" x2="77" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="138" x2="684" y1="63" y2="63"></line>
<path d="M52,82 A19,19 0 0,0 33,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="71" x2="77" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="616" x2="645" y1="101" y2="101"></line>
<path d="M52,82 A19,19 0 0,0 71,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M645,101 A19,19 0 0,0 664,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="71" x2="77" y1="171" y2="171"></line>
<line stroke="#000000" stroke-width="2" x1="382" x2="645" y1="171" y2="171"></line>
<path d="M52,152 A19,19 0 0,0 71,171" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M645,171 A19,19 0 0,0 664,152" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M683,63 A19,19 0 0,0 664,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="52" x2="52" y1="152" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="664" x2="664" y1="152" y2="82"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="15" x2="29" y1="63" y2="63"></line>
<circle cx="703" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="682" x2="696" y1="63" y2="63"></line>
<text class="title_font" x="110" y="28">numeric_term</text>
</svg>

            </object>
          </div>
        </div>
<div class="paragraph">
<p>Например, выражение фильтра</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(10|&lt;5)&amp;&gt;0</pre>
</div>
</div>
<div class="paragraph">
<p>для поля с именем "foo" будет переведено в условие</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">("foo" = 10 or "foo" &lt; 5) and "foo" &gt; 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Знаки "&gt;" и "&lt;", естественно, задают условия «строго больше» и «строго меньше», а использование символа ".." позволяет задавать условия «больше или равно» и «меньше или равно».
Так, фильтр</p>
</div>
<div class="listingblock">
<div class="content">
<pre>..0|5..7|10..</pre>
</div>
</div>
<div class="paragraph">
<p>будет транслирован в условие</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">"foo" &lt;= 0 or "foo" between 5 and 7 or "foo" &gt;= 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>(напоминаем, что оператор between в SQL задаёт диапазон с включением границ).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Внимание"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Обратите внимание, что выражение фильтра требует явной группировки скобками разных логических операторов, т. е. корректными являются выражения</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(10|&lt;5)&amp;&gt;0
10|(&lt;5&amp;&gt;0)
10|&lt;5|&gt;0</pre>
</div>
</div>
<div class="paragraph">
<p>но вызовет ошибку выражение</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10|&lt;5&amp;&gt;0</pre>
</div>
</div>
<div class="paragraph">
<p>в котором нет группирующих скобок, явно указывающих на последовательность вычисления операторов ИЛИ и И.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_выражения_фильтра_для_полей_с_типом_datetime">
<a class="anchor" href="#_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9_%D1%81_%D1%82%D0%B8%D0%BF%D0%BE%D0%BC_datetime"></a>2.3. Выражения фильтра для полей с типом DATETIME</h3>
<div class="paragraph">
<p>Выражения фильтра для полей с типом DATETIME имеют такой же синтаксис, что и для числовых полей, но вместо числового нумерала <strong>&lt;numeric literal&gt;</strong> следует использовать нумерал даты в виде 'YYYYMMDD' (апостроф, восемь цифр, апостроф).
Таким образом, правильные выражения фильтров для поля даты выглядят так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">'20131124'
'20131124'..'20151211'|'20111111'
(&gt;'20131124'&amp;..'20151211')|'20111111'..</code></pre>
</div>
</div>
<div class="paragraph">
<p>Разные типы СУБД по-разному работают с литералами дат, но Celesta транслирует выражения фильтра в условия, корректно отрабатывающиеся каждой из поддерживаемых СУБД.</p>
</div>
</div>
<div class="sect2">
<h3 id="_выражения_фильтра_для_полей_с_типом_varcharn_и_text">
<a class="anchor" href="#_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9_%D1%81_%D1%82%D0%B8%D0%BF%D0%BE%D0%BC_varcharn_%D0%B8_text"></a>2.4. Выражения фильтра для полей с типом VARCHAR(n) и TEXT</h3>
<div class="paragraph">
<p>Выражения фильтра для текстовых полей в целом похожи на выражения фильтра для числовых полей, с той лишь разницей, что вместо чисел в выражениях термов надо указывать строковые литералы в одинарных кавычках.
Например, на текстовом поле корректным является фильтр <strong>'aa'|'bb'|'cc'</strong>, который отфильтрует записи, в которых значения фильтруемого поля равны "aa", "bb" или "cc".
При этом, если нужно отфильтровать текст, содержащий одинарную кавычку, то её в текстовом литерале (как и обычно в языке SQL) следует удвоить: для отбора значений "John’s company" следует писать 'John''s company'.
Как и все прочие типы полей, текстовые поля можно фильтровать по значению null/ not null при помощи термов null/!null.</p>
</div>
<div class="paragraph">
<p>Кроме того, текстовые поля можно фильтровать при помощи оператора LIKE, применяя специальный символ %, означающий любую комбинацию любых символов, а также при помощи специального символа @ указывать на независимость фильтра от регистра.</p>
</div>
<div class="paragraph">
<p>Более точно, синтаксические правила термов фильтра для текстовых полей выглядят следующим образом:</p>
</div>

        <div id="filter_text_term" class="imageblock">
          <div class="content">
            <object type="image/svg+xml" data="create_schema.svg" width="792" height="352" version="1.0" encoding="UTF-8" standalone="no">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" height="352" preserveaspectratio="xMidYMid meet" xml:space="preserve" version="1.1" viewbox="0 0 792 352" width="792">
<style type="text/css">
<![CDATA[
.title_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:20pt; font-weight:normal; font-style:normal; }
.literal_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.token_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:16pt; font-weight:normal; font-style:normal; }
.box_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.bubble_font {fill:#000000; text-anchor:middle;
font-family:Roboto; font-size:14pt; font-weight:normal; font-style:normal; }
.label {fill: #000; text-anchor:middle; font-size:16pt; font-weight:bold; font-family:Sans;}
.link {fill: #0D47A1;}
.link:hover {fill: #0D47A1; text-decoration:underline;}
.link:visited {fill: #4A148C;}
]]>
</style>
<defs>
<marker id="arrow" markerheight="4" markerunits="strokeWidth" markerwidth="5" orient="auto" refx="2.5" refy="2">
<path d="M0,0 L0.5,2 L0,4 L4.5,2 z" fill="#000000"></path>
</marker>
</defs>
<rect fill="white" height="100%" width="100%"></rect>
<circle cx="13" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<path d="M86,79 A15,15 0 0,1 86,49 H103 A15,15 0 0,1 103,79 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="94" y="69">@</text>
<line stroke="#000000" stroke-width="2" x1="94" x2="95" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="33" x2="71" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="118" x2="157" y1="63" y2="63"></line>
<path d="M52,82 A19,19 0 0,0 33,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="71" x2="90" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="95" x2="118" y1="101" y2="101"></line>
<path d="M52,82 A19,19 0 0,0 71,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M118,101 A19,19 0 0,0 137,82" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M156,63 A19,19 0 0,0 137,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="52" x2="52" y1="82" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="137" x2="137" y1="82" y2="82"></line>
<path d="M235,78 A14,14 0 0,1 235,50 H264 A14,14 0 0,1 264,78 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="bubble_font" x="249" y="69">null</text>
<path d="M228,116 H326 L333,102 L326,88 H228 L221,102 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="277" y="107">text literal</text>
<path d="M403,117 A15,15 0 0,1 403,87 H415 A15,15 0 0,1 415,117 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="409" y="107">..</text>
<path d="M492,116 H590 L597,102 L590,88 H492 L485,102 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="541" y="107">text literal</text>
<line stroke="#000000" stroke-width="2" x1="540" x2="541" y1="139" y2="139"></line>
<line stroke="#000000" stroke-width="2" x1="447" x2="485" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="597" x2="636" y1="101" y2="101"></line>
<path d="M466,120 A19,19 0 0,0 447,101" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="485" x2="536" y1="139" y2="139"></line>
<line stroke="#000000" stroke-width="2" x1="541" x2="597" y1="139" y2="139"></line>
<path d="M466,120 A19,19 0 0,0 485,139" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M597,139 A19,19 0 0,0 616,120" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M635,101 A19,19 0 0,0 616,120" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="466" x2="466" y1="120" y2="120"></line>
<line stroke="#000000" stroke-width="2" x1="616" x2="616" y1="120" y2="120"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="429" x2="443" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="520" x2="521" y1="148" y2="148"></line>
<line stroke="#000000" stroke-width="2" x1="350" x2="388" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="635" x2="693" y1="101" y2="101"></line>
<path d="M369,120 A19,19 0 0,0 350,101" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="388" x2="516" y1="148" y2="148"></line>
<line stroke="#000000" stroke-width="2" x1="521" x2="654" y1="148" y2="148"></line>
<path d="M369,129 A19,19 0 0,0 388,148" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M654,148 A19,19 0 0,0 673,129" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M692,101 A19,19 0 0,0 673,120" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="369" x2="369" y1="129" y2="120"></line>
<line stroke="#000000" stroke-width="2" x1="673" x2="673" y1="129" y2="120"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="332" x2="346" y1="101" y2="101"></line>
<path d="M284,187 A15,15 0 0,1 284,157 H296 A15,15 0 0,1 296,187 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="290" y="177">..</text>
<path d="M284,226 A15,15 0 0,1 284,196 H298 A15,15 0 0,1 298,226 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="291" y="216">&gt;</text>
<path d="M284,265 A15,15 0 0,1 284,235 H298 A15,15 0 0,1 298,265 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="291" y="255">&lt;</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="221" x2="265" y1="171" y2="171"></line>
<line stroke="#000000" stroke-width="2" x1="311" x2="362" y1="171" y2="171"></line>
<path d="M240,190 A19,19 0 0,0 221,171" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="259" x2="265" y1="210" y2="210"></line>
<line stroke="#000000" stroke-width="2" x1="313" x2="323" y1="210" y2="210"></line>
<path d="M240,191 A19,19 0 0,0 259,210" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M323,210 A19,19 0 0,0 342,191" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="259" x2="265" y1="249" y2="249"></line>
<line stroke="#000000" stroke-width="2" x1="313" x2="323" y1="249" y2="249"></line>
<path d="M240,230 A19,19 0 0,0 259,249" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M323,249 A19,19 0 0,0 342,230" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M361,171 A19,19 0 0,0 342,190" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="240" x2="240" y1="230" y2="190"></line>
<line stroke="#000000" stroke-width="2" x1="342" x2="342" y1="230" y2="190"></line>
<path d="M385,186 H483 L490,172 L483,158 H385 L378,172 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="434" y="177">text literal</text>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="360" x2="374" y1="171" y2="171"></line>
<path d="M274,304 A15,15 0 0,1 274,274 H290 A15,15 0 0,1 290,304 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="282" y="294">%</text>
<line stroke="#000000" stroke-width="2" x1="281" x2="282" y1="326" y2="326"></line>
<line stroke="#000000" stroke-width="2" x1="221" x2="259" y1="288" y2="288"></line>
<line stroke="#000000" stroke-width="2" x1="305" x2="344" y1="288" y2="288"></line>
<path d="M240,307 A19,19 0 0,0 221,288" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="259" x2="277" y1="326" y2="326"></line>
<line stroke="#000000" stroke-width="2" x1="282" x2="305" y1="326" y2="326"></line>
<path d="M240,307 A19,19 0 0,0 259,326" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M305,326 A19,19 0 0,0 324,307" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M343,288 A19,19 0 0,0 324,307" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="240" x2="240" y1="307" y2="307"></line>
<line stroke="#000000" stroke-width="2" x1="324" x2="324" y1="307" y2="307"></line>
<path d="M386,303 H484 L491,289 L484,275 H386 L379,289 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="literal_font" x="435" y="294">text literal</text>
<path d="M427,342 A15,15 0 0,1 427,312 H443 A15,15 0 0,1 443,342 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="435" y="332">%</text>
<line stroke="#000000" stroke-width="2" x1="379" x2="412" y1="326" y2="326"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="491" x2="462" y1="326" y2="326"></line>
<line stroke="#000000" stroke-width="2" x1="360" x2="379" y1="288" y2="288"></line>
<path d="M379,288 A9,9 0 0,0 370,297" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="370" x2="370" y1="317" y2="311"></line>
<line stroke="#000000" stroke-width="2" x1="370" x2="370" y1="307" y2="297"></line>
<path d="M370,317 A9,9 0 0,0 379,326" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M500,297 A9,9 0 0,0 491,288" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="500" x2="500" y1="297" y2="303"></line>
<line stroke="#000000" stroke-width="2" x1="500" x2="500" y1="307" y2="317"></line>
<path d="M491,326 A9,9 0 0,0 500,317" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="491" x2="500" y1="288" y2="288"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="342" x2="356" y1="288" y2="288"></line>
<path d="M570,304 A15,15 0 0,1 570,274 H586 A15,15 0 0,1 586,304 z" fill="#ffffff" fill-opacity="1.0" stroke="#000000" stroke-width="2"></path>
<text class="token_font" x="578" y="294">%</text>
<line stroke="#000000" stroke-width="2" x1="577" x2="578" y1="326" y2="326"></line>
<line stroke="#000000" stroke-width="2" x1="517" x2="555" y1="288" y2="288"></line>
<line stroke="#000000" stroke-width="2" x1="601" x2="640" y1="288" y2="288"></line>
<path d="M536,307 A19,19 0 0,0 517,288" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="555" x2="573" y1="326" y2="326"></line>
<line stroke="#000000" stroke-width="2" x1="578" x2="601" y1="326" y2="326"></line>
<path d="M536,307 A19,19 0 0,0 555,326" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M601,326 A19,19 0 0,0 620,307" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M639,288 A19,19 0 0,0 620,307" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="536" x2="536" y1="307" y2="307"></line>
<line stroke="#000000" stroke-width="2" x1="620" x2="620" y1="307" y2="307"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="499" x2="513" y1="288" y2="288"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="173" x2="217" y1="63" y2="63"></line>
<line stroke="#000000" stroke-width="2" x1="278" x2="760" y1="63" y2="63"></line>
<path d="M192,82 A19,19 0 0,0 173,63" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="211" x2="217" y1="101" y2="101"></line>
<line stroke="#000000" stroke-width="2" x1="692" x2="721" y1="101" y2="101"></line>
<path d="M192,82 A19,19 0 0,0 211,101" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M721,101 A19,19 0 0,0 740,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="211" x2="217" y1="171" y2="171"></line>
<line stroke="#000000" stroke-width="2" x1="490" x2="721" y1="171" y2="171"></line>
<path d="M192,152 A19,19 0 0,0 211,171" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M721,171 A19,19 0 0,0 740,152" fill="none" stroke="#000000" stroke-width="2"></path>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="211" x2="217" y1="288" y2="288"></line>
<line stroke="#000000" stroke-width="2" x1="639" x2="721" y1="288" y2="288"></line>
<path d="M192,269 A19,19 0 0,0 211,288" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M721,288 A19,19 0 0,0 740,269" fill="none" stroke="#000000" stroke-width="2"></path>
<path d="M759,63 A19,19 0 0,0 740,82" fill="none" stroke="#000000" stroke-width="2"></path>
<line stroke="#000000" stroke-width="2" x1="192" x2="192" y1="269" y2="82"></line>
<line stroke="#000000" stroke-width="2" x1="740" x2="740" y1="269" y2="82"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="155" x2="169" y1="63" y2="63"></line>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="15" x2="29" y1="63" y2="63"></line>
<circle cx="779" cy="63" fill="#ffffff" r="3" stroke="#000000" stroke-width="2"></circle>
<line marker-end="url(#arrow)" stroke="#000000" stroke-width="2" x1="758" x2="772" y1="63" y2="63"></line>
<text class="title_font" x="88" y="28">text_term</text>
</svg>

            </object>
          </div>
        </div>
<div class="paragraph">
<p>Так, выражение</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">('aaa'&amp;'bb')|(!'ddd'&amp;!null)</code></pre>
</div>
</div>
<div class="paragraph">
<p>будет транслировано в</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">(("foo" = 'aaa' and "foo" = 'bb') or (not ("foo" = 'ddd') and not ("foo" is null))</code></pre>
</div>
</div>
<div class="paragraph">
<p>(что естественно никогда не будет выполнено, этот и следующий примеры даны лишь для иллюстрации принципа трансляции фильтров в язык SQL).</p>
</div>
<div class="paragraph">
<p>Выражение</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">@'q'|@..'cC'|@'Ff'..|@'a'..'b'|@%'5a'|'abc'%|! @ %'ef'%|null</code></pre>
</div>
</div>
<div class="paragraph">
<p>использующее знаки @, транслируется в</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">UPPER("foo") = 'Q' or UPPER("foo") &lt;= 'CC' or UPPER("foo") &gt;= 'FF' or UPPER("foo") between 'A' and 'B'
or UPPER("foo") like '%5A' or "foo" like 'abc%' or not (UPPER("foo") like '%EF%') or "foo" is null</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setIn_usage">
<a class="anchor" href="#setIn_usage"></a>3. Использование метода setIn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Метод <strong>setFilter</strong> позволяет фильтровать записи, некоторое поле которых принимает любое значение из заранее заданного набора.
К примеру,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">myCursor.setFilter(myCursor.COLUMNS.city_id(), "'MSK'|'LON'");</code></pre>
</div>
</div>
<div class="paragraph">
<p>отфильтровывает записи, поле «код города» которых принимает значение MSK или LON.
Вызов</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">myCursor.setFilter(myCursor.COLUMNS.city_id(), "'M'%");</code></pre>
</div>
</div>
<div class="paragraph">
<p>отфильтровывает записи, код города в которых начинается с латинской буквы M.</p>
</div>
<div class="paragraph">
<p>Однако функциональности <strong>setFilter</strong> бывает недостаточно: что если необходимо отфильтровать записи, относящиеся к городам, находящимся в определённом регионе или стране?</p>
</div>
<div class="paragraph">
<p>Одним из способов решения такой задачи могло быть следующее: отфильтровать справочник городов по <code>city.setRange(city.COLUMNS.country_id(), "RUS")</code>, далее выгрузить из базы данных в память полный набор идентификаторов таких городов, объединить их в строку фильтра через вертикальную черту, и использовать это как фильтр на другом курсоре.
Ясно, что такой подход плох, если попадающих в фильтр записей слишком много: это породит обмен лишними данными по сети и слишком длинный SQL-запрос к интересующей нас таблице.</p>
</div>
<div class="paragraph">
<p>Для этого случая применяется метод <code>setIn</code>, который позволяет установить фильтр с вложенным запросом по указанному набору полей.
Доступен для наследников классов Cursor и ViewCursor.</p>
</div>
<div class="paragraph">
<p>Общая схема работы с <code>setIn</code> такова:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>устанавливаются фильтры на целевом и вспомогательных курсорах (в приведённом выше примере <code>myCursor</code> играет роль целевого, а <code>city</code> — вспомогательного),</p>
</li>
<li>
<p>устанавливается связь полей между целевым и вспомогательными курсорами.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Связь полей задается при помощи класса <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/filter/value/FieldsLookup.html"><code>FieldsLookup</code></a>, возвращаемого в качестве результата из метода <code>setIn</code> целевого курсора.
Метод <code>setIn</code> принимает в качестве единственного аргумента объект вспомогательного курсора, по которому ищется пересечение.
Подготовка целевого курсора и аккумулирование пар столбцов с последующей установкой фильтра происходит следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TargetCursor a = new TargetCursor(context);
AuxiliaryCursor b = new AuxiliaryCursor(context);
b.setRange(b.COLUMNS.foo(), "bar");
a.setIn(b)
     .add(a.COLUMNS.a1(), b.COLUMNS.b1())
     .add(a.COLUMNS.a2(), b.COLUMNS.b2());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для данного примера в PostgreSQL для доступа к строкам курсора <code>a</code> будет сгенерировано следующее sql выражение:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT ... FROM Target WHERE ( a1, a2 ) IN (SELECT b1, b2 FROM Auxiliary WHERE Auxiliary.foo = 'bar' )</code></pre>
</div>
</div>
<div class="paragraph">
<p>К целевому курсору можно применить любое число вспомогательных курсоров через метод <code>and</code> класса <code>FieldsLookup</code>.
При этом вспомогательные курсоры между собой никак не пересекаются.
Пример задания нескольких вспомогательных курсоров ниже:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">TargetCursor a = new TargetCursor(context);
a.setRange(a.COLUMNS.afoo(), "aBar");
AuxiliaryCursor b = new AuxiliaryCursor(context);
b.setRange(b.COLUMNS.bFoo(), "bBar");
Auxiliary2Cursor c = new Auxiliary2Cursor(context);
c.setRange(c.COLUMNS.cFoo(), "cBar");
a.setIn(b)
     .add(a.COLUMNS.a1(), b.COLUMNS.b1())
     .add(a.COLUMNS.a2(), b.COLUMNS.b2());
.and(c)
     .add(a.COLUMNS.a1(), c.COLUMNS.c1());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Для данного примера в PostgreSQL для доступа к строкам курсора a будет сгенерировано следующее sql выражение:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT ...
FROM Target
WHERE aFoo = 'aBar'
    AND ( a1, a2 ) IN (SELECT b1, b2 FROM Auxiliary WHERE Auxiliary.bFoo = 'bBar' )
    AND (a1) IN (SELECT c1 FROM Auxiliary2 WHERE Auxiliary2.cFoo = 'cBar' )</code></pre>
</div>
</div>
<div class="paragraph">
<p>У данного фильтра имеется набор ограничений, несоблюдение которых приведёт к выбрасыванию исключения во время выполнения методов <code>FieldsLookup.add</code> или <code>BasicCursor.setIn</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Типы данных у каждой пары сопоставляемых полей должны в точности совпадать.</p>
</li>
<li>
<p>В каждой из таблиц должен существовать индекс, включающий в себя все столбцы из набора сопоставляемых столбцов: для примера выше для таблицы <code>Target</code> должен иметься индекс <code>I1(a1, a2,..)</code>, для <code>Auxiliary</code> — <code>I2(b1, b2,…​)</code>.</p>
</li>
<li>
<p>Для курсоров на таблицы соответствующие индексы должны содержать сопоставляемые столбцы в своём начале.
Для нашего примера, если имеются индексы <code>I1(a1, a2,..)</code>, <code>I2(b1, b2,…​)</code>, следующий код вызовет исключение, т. к. поля <code>a2</code>, <code>b2</code> находятся не в начале индексов <code>I1</code> и <code>I2</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">a.setIn(b).add(a.CURSORS.a2(), b.CURSORS.b2());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_класс_sequence">
<a class="anchor" href="#_%D0%BA%D0%BB%D0%B0%D1%81%D1%81_sequence"></a>4. Класс Sequence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Класс <a href="https://courseorchestra.github.io/celesta/apidocs/index.html?ru/curs/celesta/dbutils/Sequence.html">Sequence</a> позволяет работать с последовательностями.
В отличие от остальных классов доступа при кодогенерации вместо суффикса Cursor используется суффикс Sequence.
Класс Sequence имеет единственный метод <code>nextValue</code>, позволяющий получить следующее значение последовательности в виде типа <code>long</code>.</p>
</div>
<div class="paragraph">
<p>Ниже приведен пример использования класса доступа Sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE SCHEMA sequences version '1.0';
CREATE SEQUENCE idNumerator START WITH 3;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">IdNumeratorSequence sq  = new IdNumeratorSequence(ctx);
//выводит следующее значение, начиная с 3.
System.out.println(sq.nextValue());</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/vendor/lunr-languages.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
